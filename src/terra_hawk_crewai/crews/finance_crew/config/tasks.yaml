financial_task:
  description: >
    Use the finance_retriever tool to retrieve financial data for {farm_id} over the past 2 days.
    Conduct a comprehensive financial analysis including budget analysis, forecasting, cost-benefit analysis,
    ROI calculations per field zone, and cash flow analysis. The current date is {date}.
    Analyze revenue streams (crop sales, drone services, subsidies), expense categories (operations, maintenance, labor),
    and operational costs (drone operations per zone). Identify trends, cost optimization opportunities, profitability by zone,
    and provide actionable recommendations for improving financial performance.
    Create a comprehensive markdown financial analysis report with findings and recommendations.
  expected_output: >
    A neatly formatted JSON string containing the financial analysis:
    - financial_analysis: Object containing:
      - summary: A brief narrative summary of the financial analysis and key findings
      - farm_id: The farm ID that was analyzed
      - analysis_period: Time range analyzed (start and end dates)
      - total_days_analyzed: Number of days of data analyzed
      - financial_overview: Object containing:
      - total_revenue: Total revenue in EUR
      - total_expenses: Total expenses in EUR
      - total_operational_costs: Total operational costs in EUR
      - net_profit: Net profit in EUR
      - profit_margin_percentage: Profit margin as percentage
    - revenue_analysis: Object containing:
      - revenue_by_type: Array of objects with revenue_type, amount, percentage_of_total
      - top_revenue_sources: Array of top 3 revenue sources
      - revenue_trend: String ("Increasing", "Stable", "Decreasing")
    - expense_analysis: Object containing:
      - expense_by_category: Array of objects with category, amount, percentage_of_total
      - top_expense_categories: Array of top 3 expense categories
      - expense_trend: String ("Increasing", "Stable", "Decreasing")
    - operational_analysis: Object containing:
      - total_flight_time_minutes: Total drone flight time
      - total_area_covered_hectares: Total area covered by operations
      - average_cost_per_hectare: Average operational cost per hectare
      - operations_by_type: Array of objects with operation_type, count, total_cost
    - roi_by_zone: Array of objects containing:
      - zone: String zone name
      - revenue: Revenue from zone
      - costs: Total costs for zone
      - roi_percentage: ROI as percentage
      - status: String ("Profitable", "Break-even", "Loss-making")
    - cash_flow_analysis: Object containing:
      - cash_inflow: Total revenue
      - cash_outflow: Total expenses + operational costs
      - net_cash_flow: Net cash flow
      - cash_flow_status: String ("Positive", "Neutral", "Negative")
    - forecasts: Object containing:
      - projected_monthly_revenue: Projected revenue for next month
      - projected_monthly_expenses: Projected expenses for next month
      - projected_monthly_profit: Projected profit for next month
    - recommendations: Array of actionable financial recommendations
    - alerts: Array of critical financial issues requiring immediate attention

    Example format:
    {
      "financial_analysis": {
        "summary": "Strong financial performance with 23% profit margin. Drone operations in Zone 2 show highest ROI. Consider reducing labor costs in Zone 3.",
        "farm_id": "FARM-001",
        "analysis_period": "2025-12-27 to 2026-01-27",
        "total_days_analyzed": 30,
        "financial_overview": {
        "total_revenue": 45000.50,
        "total_expenses": 28000.75,
        "total_operational_costs": 6500.25,
        "net_profit": 10499.50,
        "profit_margin_percentage": 23.3
      },
      "revenue_analysis": {
        "revenue_by_type": [
          {
            "revenue_type": "crop_sales",
            "amount": 35000.00,
            "percentage_of_total": 77.8
          },
          {
            "revenue_type": "drone_services",
            "amount": 8000.50,
            "percentage_of_total": 17.8
          }
        ],
        "top_revenue_sources": ["crop_sales", "drone_services", "government_subsidies"],
        "revenue_trend": "Increasing"
      },
      "expense_analysis": {
        "expense_by_category": [
          {
            "category": "labor",
            "amount": 12000.00,
            "percentage_of_total": 42.9
          },
          {
            "category": "drone_maintenance",
            "amount": 5500.75,
            "percentage_of_total": 19.6
          }
        ],
        "top_expense_categories": ["labor", "drone_maintenance", "fuel_battery"],
        "expense_trend": "Stable"
      },
      "operational_analysis": {
        "total_flight_time_minutes": 2450,
        "total_area_covered_hectares": 125.5,
        "average_cost_per_hectare": 51.79,
        "operations_by_type": [
          {
            "operation_type": "spraying",
            "count": 45,
            "total_cost": 3200.50
          }
        ]
      },
      "roi_by_zone": [
        {
          "zone": "Zone_1",
          "revenue": 15000.00,
          "costs": 11000.50,
          "roi_percentage": 36.4,
          "status": "Profitable"
        },
        {
          "zone": "Zone_2",
          "revenue": 18000.00,
          "costs": 10500.25,
          "roi_percentage": 71.4,
          "status": "Profitable"
        }
      ],
      "cash_flow_analysis": {
        "cash_inflow": 45000.50,
        "cash_outflow": 34501.00,
        "net_cash_flow": 10499.50,
        "cash_flow_status": "Positive"
      },
      "forecasts": {
        "projected_monthly_revenue": 47250.00,
        "projected_monthly_expenses": 35500.00,
        "projected_monthly_profit": 11750.00
      },
      "recommendations": [
        "Zone 2 shows highest ROI (71.4%) - allocate more resources to this zone",
        "Labor costs represent 42.9% of expenses - consider automation opportunities",
        "Drone services revenue growing - expand service offerings to neighboring farms"
      ],
      "alerts": [
        "Zone 3 operating at loss - immediate cost reduction needed",
        "3 unpaid invoices totaling EUR 5,200 - follow up with customers"
      ]
      }
    }
  agent: financial_analyst
